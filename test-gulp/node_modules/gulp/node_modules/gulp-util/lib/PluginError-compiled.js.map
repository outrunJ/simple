{"version":3,"sources":["PluginError.js"],"names":[],"mappings":"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","file":"PluginError-compiled.js","sourcesContent":["var util = require('util');\nvar arrayDiffer = require('array-differ');\nvar arrayUniq = require('array-uniq');\nvar chalk = require('chalk');\nvar objectAssign = require('object-assign');\n\nvar nonEnumberableProperties = ['name', 'message', 'stack'];\nvar propertiesNotToDisplay = nonEnumberableProperties.concat(['plugin', 'showStack', 'showProperties', '__safety', '_stack']);\n\n// wow what a clusterfuck\nvar parseOptions = function(plugin, message, opt) {\n  opt = opt || {};\n  if (typeof plugin === 'object') {\n    opt = plugin;\n  } else {\n    if (message instanceof Error) {\n      opt.error = message;\n    } else if (typeof message === 'object') {\n      opt = message;\n    } else {\n      opt.message = message;\n    }\n    opt.plugin = plugin;\n  }\n\n  return objectAssign({\n    showStack: false,\n    showProperties: true\n  }, opt);\n};\n\nfunction PluginError(plugin, message, opt) {\n  if (!(this instanceof PluginError)) throw new Error('Call PluginError using new');\n\n  Error.call(this);\n\n  var options = parseOptions(plugin, message, opt);\n  var self = this;\n\n  // if options has an error, grab details from it\n  if (options.error) {\n    // These properties are not enumerable, so we have to add them explicitly.\n    arrayUniq(Object.keys(options.error).concat(nonEnumberableProperties))\n      .forEach(function(prop) {\n        self[prop] = options.error[prop];\n      });\n  }\n\n  var properties = ['name', 'message', 'fileName', 'lineNumber', 'stack', 'showStack', 'showProperties', 'plugin'];\n\n  // options object can override\n  properties.forEach(function(prop) {\n    if (prop in options) this[prop] = options[prop];\n  }, this);\n\n  // defaults\n  if (!this.name) this.name = 'Error';\n\n  if (!this.stack) {\n    // Error.captureStackTrace appends a stack property which relies on the toString method of the object it is applied to.\n    // Since we are using our own toString method which controls when to display the stack trace if we don't go through this\n    // safety object, then we'll get stack overflow problems.\n    var safety = {\n      toString: function() {\n        return this._messageWithDetails() + '\\nStack:';\n      }.bind(this)\n    };\n    Error.captureStackTrace(safety, arguments.callee || this.constructor);\n    this.__safety = safety;\n  }\n\n  if (!this.plugin) throw new Error('Missing plugin name');\n  if (!this.message) throw new Error('Missing error message');\n}\n\nutil.inherits(PluginError, Error);\n\nPluginError.prototype._messageWithDetails = function() {\n  var messageWithDetails = 'Message:\\n    ' + this.message;\n  var details = this._messageDetails();\n\n  if (details !== '') {\n    messageWithDetails += '\\n' + details;\n  }\n\n  return messageWithDetails;\n};\n\nPluginError.prototype._messageDetails = function() {\n  if (!this.showProperties) {\n    return '';\n  }\n\n  var properties = arrayDiffer(Object.keys(this), propertiesNotToDisplay);\n\n  if (properties.length === 0) {\n    return '';\n  }\n\n  var self = this;\n  properties = properties.map(function stringifyProperty(prop) {\n    return '    ' + prop + ': ' + self[prop];\n  });\n\n  return 'Details:\\n' + properties.join('\\n');\n};\n\nPluginError.prototype.toString = function () {\n  var sig = chalk.red(this.name) + ' in plugin \\'' + chalk.cyan(this.plugin) + '\\'';\n  var detailsWithStack = function(stack) {\n    return this._messageWithDetails() + '\\nStack:\\n' + stack;\n  }.bind(this);\n\n  var msg;\n  if (this.showStack) {\n    if (this.__safety) { // There is no wrapped error, use the stack captured in the PluginError ctor\n      msg = this.__safety.stack;\n    } else if (this._stack) {\n      msg = detailsWithStack(this._stack);\n    } else { // Stack from wrapped error\n      msg = detailsWithStack(this.stack);\n    }\n  } else {\n    msg = this._messageWithDetails();\n  }\n\n  return sig + '\\n' + msg;\n};\n\nmodule.exports = PluginError;\n"]}