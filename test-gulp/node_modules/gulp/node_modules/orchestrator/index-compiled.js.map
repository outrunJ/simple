{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["/*jshint node:true */\n\n\"use strict\";\n\nvar util = require('util');\nvar events = require('events');\nvar EventEmitter = events.EventEmitter;\nvar runTask = require('./lib/runTask');\n\nvar Orchestrator = function () {\n\tEventEmitter.call(this);\n\tthis.doneCallback = undefined; // call this when all tasks in the queue are done\n\tthis.seq = []; // the order to run the tasks\n\tthis.tasks = {}; // task objects: name, dep (list of names of dependencies), fn (the task to run)\n\tthis.isRunning = false; // is the orchestrator running tasks? .start() to start, .stop() to stop\n};\nutil.inherits(Orchestrator, EventEmitter);\n\n\tOrchestrator.prototype.reset = function () {\n\t\tif (this.isRunning) {\n\t\t\tthis.stop(null);\n\t\t}\n\t\tthis.tasks = {};\n\t\tthis.seq = [];\n\t\tthis.isRunning = false;\n\t\tthis.doneCallback = undefined;\n\t\treturn this;\n\t};\n\tOrchestrator.prototype.add = function (name, dep, fn) {\n\t\tif (!fn && typeof dep === 'function') {\n\t\t\tfn = dep;\n\t\t\tdep = undefined;\n\t\t}\n\t\tdep = dep || [];\n\t\tfn = fn || function () {}; // no-op\n\t\tif (!name) {\n\t\t\tthrow new Error('Task requires a name');\n\t\t}\n\t\t// validate name is a string, dep is an array of strings, and fn is a function\n\t\tif (typeof name !== 'string') {\n\t\t\tthrow new Error('Task requires a name that is a string');\n\t\t}\n\t\tif (typeof fn !== 'function') {\n\t\t\tthrow new Error('Task '+name+' requires a function that is a function');\n\t\t}\n\t\tif (!Array.isArray(dep)) {\n\t\t\tthrow new Error('Task '+name+' can\\'t support dependencies that is not an array of strings');\n\t\t}\n\t\tdep.forEach(function (item) {\n\t\t\tif (typeof item !== 'string') {\n\t\t\t\tthrow new Error('Task '+name+' dependency '+item+' is not a string');\n\t\t\t}\n\t\t});\n\t\tthis.tasks[name] = {\n\t\t\tfn: fn,\n\t\t\tdep: dep,\n\t\t\tname: name\n\t\t};\n\t\treturn this;\n\t};\n\tOrchestrator.prototype.task = function (name, dep, fn) {\n\t\tif (dep || fn) {\n\t\t\t// alias for add, return nothing rather than this\n\t\t\tthis.add(name, dep, fn);\n\t\t} else {\n\t\t\treturn this.tasks[name];\n\t\t}\n\t};\n\tOrchestrator.prototype.hasTask = function (name) {\n\t\treturn !!this.tasks[name];\n\t};\n\t// tasks and optionally a callback\n\tOrchestrator.prototype.start = function() {\n\t\tvar args, arg, names = [], lastTask, i, seq = [];\n\t\targs = Array.prototype.slice.call(arguments, 0);\n\t\tif (args.length) {\n\t\t\tlastTask = args[args.length-1];\n\t\t\tif (typeof lastTask === 'function') {\n\t\t\t\tthis.doneCallback = lastTask;\n\t\t\t\targs.pop();\n\t\t\t}\n\t\t\tfor (i = 0; i < args.length; i++) {\n\t\t\t\targ = args[i];\n\t\t\t\tif (typeof arg === 'string') {\n\t\t\t\t\tnames.push(arg);\n\t\t\t\t} else if (Array.isArray(arg)) {\n\t\t\t\t\tnames = names.concat(arg); // FRAGILE: ASSUME: it's an array of strings\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('pass strings or arrays of strings');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (this.isRunning) {\n\t\t\t// reset specified tasks (and dependencies) as not run\n\t\t\tthis._resetSpecificTasks(names);\n\t\t} else {\n\t\t\t// reset all tasks as not run\n\t\t\tthis._resetAllTasks();\n\t\t}\n\t\tif (this.isRunning) {\n\t\t\t// if you call start() again while a previous run is still in play\n\t\t\t// prepend the new tasks to the existing task queue\n\t\t\tnames = names.concat(this.seq);\n\t\t}\n\t\tif (names.length < 1) {\n\t\t\t// run all tasks\n\t\t\tfor (i in this.tasks) {\n\t\t\t\tif (this.tasks.hasOwnProperty(i)) {\n\t\t\t\t\tnames.push(this.tasks[i].name);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tseq = [];\n\t\ttry {\n\t\t\tthis.sequence(this.tasks, names, seq, []);\n\t\t} catch (err) {\n\t\t\t// Is this a known error?\n\t\t\tif (err) {\n\t\t\t\tif (err.missingTask) {\n\t\t\t\t\tthis.emit('task_not_found', {message: err.message, task:err.missingTask, err: err});\n\t\t\t\t}\n\t\t\t\tif (err.recursiveTasks) {\n\t\t\t\t\tthis.emit('task_recursion', {message: err.message, recursiveTasks:err.recursiveTasks, err: err});\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.stop(err);\n\t\t\treturn this;\n\t\t}\n\t\tthis.seq = seq;\n\t\tthis.emit('start', {message:'seq: '+this.seq.join(',')});\n\t\tif (!this.isRunning) {\n\t\t\tthis.isRunning = true;\n\t\t}\n\t\tthis._runStep();\n\t\treturn this;\n\t};\n\tOrchestrator.prototype.stop = function (err, successfulFinish) {\n\t\tthis.isRunning = false;\n\t\tif (err) {\n\t\t\tthis.emit('err', {message:'orchestration failed', err:err});\n\t\t} else if (successfulFinish) {\n\t\t\tthis.emit('stop', {message:'orchestration succeeded'});\n\t\t} else {\n\t\t\t// ASSUME\n\t\t\terr = 'orchestration aborted';\n\t\t\tthis.emit('err', {message:'orchestration aborted', err: err});\n\t\t}\n\t\tif (this.doneCallback) {\n\t\t\t// Avoid calling it multiple times\n\t\t\tthis.doneCallback(err);\n\t\t} else if (err && !this.listeners('err').length) {\n\t\t\t// No one is listening for the error so speak louder\n\t\t\tthrow err;\n\t\t}\n\t};\n\tOrchestrator.prototype.sequence = require('sequencify');\n\tOrchestrator.prototype.allDone = function () {\n\t\tvar i, task, allDone = true; // nothing disputed it yet\n\t\tfor (i = 0; i < this.seq.length; i++) {\n\t\t\ttask = this.tasks[this.seq[i]];\n\t\t\tif (!task.done) {\n\t\t\t\tallDone = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn allDone;\n\t};\n\tOrchestrator.prototype._resetTask = function(task) {\n\t\tif (task) {\n\t\t\tif (task.done) {\n\t\t\t\ttask.done = false;\n\t\t\t}\n\t\t\tdelete task.start;\n\t\t\tdelete task.stop;\n\t\t\tdelete task.duration;\n\t\t\tdelete task.hrDuration;\n\t\t\tdelete task.args;\n\t\t}\n\t};\n\tOrchestrator.prototype._resetAllTasks = function() {\n\t\tvar task;\n\t\tfor (task in this.tasks) {\n\t\t\tif (this.tasks.hasOwnProperty(task)) {\n\t\t\t\tthis._resetTask(this.tasks[task]);\n\t\t\t}\n\t\t}\n\t};\n\tOrchestrator.prototype._resetSpecificTasks = function (names) {\n\t\tvar i, name, t;\n\n\t\tif (names && names.length) {\n\t\t\tfor (i = 0; i < names.length; i++) {\n\t\t\t\tname = names[i];\n\t\t\t\tt = this.tasks[name];\n\t\t\t\tif (t) {\n\t\t\t\t\tthis._resetTask(t);\n\t\t\t\t\tif (t.dep && t.dep.length) {\n\t\t\t\t\t\tthis._resetSpecificTasks(t.dep); // recurse\n\t\t\t\t\t}\n\t\t\t\t//} else {\n\t\t\t\t\t// FRAGILE: ignore that the task doesn't exist\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\tOrchestrator.prototype._runStep = function () {\n\t\tvar i, task;\n\t\tif (!this.isRunning) {\n\t\t\treturn; // user aborted, ASSUME: stop called previously\n\t\t}\n\t\tfor (i = 0; i < this.seq.length; i++) {\n\t\t\ttask = this.tasks[this.seq[i]];\n\t\t\tif (!task.done && !task.running && this._readyToRunTask(task)) {\n\t\t\t\tthis._runTask(task);\n\t\t\t}\n\t\t\tif (!this.isRunning) {\n\t\t\t\treturn; // task failed or user aborted, ASSUME: stop called previously\n\t\t\t}\n\t\t}\n\t\tif (this.allDone()) {\n\t\t\tthis.stop(null, true);\n\t\t}\n\t};\n\tOrchestrator.prototype._readyToRunTask = function (task) {\n\t\tvar ready = true, // no one disproved it yet\n\t\t\ti, name, t;\n\t\tif (task.dep.length) {\n\t\t\tfor (i = 0; i < task.dep.length; i++) {\n\t\t\t\tname = task.dep[i];\n\t\t\t\tt = this.tasks[name];\n\t\t\t\tif (!t) {\n\t\t\t\t\t// FRAGILE: this should never happen\n\t\t\t\t\tthis.stop(\"can't run \"+task.name+\" because it depends on \"+name+\" which doesn't exist\");\n\t\t\t\t\tready = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (!t.done) {\n\t\t\t\t\tready = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn ready;\n\t};\n\tOrchestrator.prototype._stopTask = function (task, meta) {\n\t\ttask.duration = meta.duration;\n\t\ttask.hrDuration = meta.hrDuration;\n\t\ttask.running = false;\n\t\ttask.done = true;\n\t};\n\tOrchestrator.prototype._emitTaskDone = function (task, message, err) {\n\t\tif (!task.args) {\n\t\t\ttask.args = {task:task.name};\n\t\t}\n\t\ttask.args.duration = task.duration;\n\t\ttask.args.hrDuration = task.hrDuration;\n\t\ttask.args.message = task.name+' '+message;\n\t\tvar evt = 'stop';\n\t\tif (err) {\n\t\t\ttask.args.err = err;\n\t\t\tevt = 'err';\n\t\t}\n\t\t// 'task_stop' or 'task_err'\n\t\tthis.emit('task_'+evt, task.args);\n\t};\n\tOrchestrator.prototype._runTask = function (task) {\n\t\tvar that = this;\n\n\t\ttask.args = {task:task.name, message:task.name+' started'};\n\t\tthis.emit('task_start', task.args);\n\t\ttask.running = true;\n\n\t\trunTask(task.fn.bind(this), function (err, meta) {\n\t\t\tthat._stopTask.call(that, task, meta);\n\t\t\tthat._emitTaskDone.call(that, task, meta.runMethod, err);\n\t\t\tif (err) {\n\t\t\t\treturn that.stop.call(that, err);\n\t\t\t}\n\t\t\tthat._runStep.call(that);\n\t\t});\n\t};\n\n// FRAGILE: ASSUME: this list is an exhaustive list of events emitted\nvar events = ['start','stop','err','task_start','task_stop','task_err','task_not_found','task_recursion'];\n\nvar listenToEvent = function (target, event, callback) {\n\ttarget.on(event, function (e) {\n\t\te.src = event;\n\t\tcallback(e);\n\t});\n};\n\n\tOrchestrator.prototype.onAll = function (callback) {\n\t\tvar i;\n\t\tif (typeof callback !== 'function') {\n\t\t\tthrow new Error('No callback specified');\n\t\t}\n\n\t\tfor (i = 0; i < events.length; i++) {\n\t\t\tlistenToEvent(this, events[i], callback);\n\t\t}\n\t};\n\nmodule.exports = Orchestrator;\n"]}